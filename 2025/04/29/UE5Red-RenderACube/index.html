<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>UE5 Render a Cube | Canned Pixels</title><meta name="author" content="Zishuai Zhang,zhangzs2023@163.com"><meta name="copyright" content="Zishuai Zhang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="Data Structure and Relationships on the CPU SideCube Asset场景中的一个Cube的添加，engine做了:add一个StaticMeshActor到scene，这个actor包含了一个 UStaticMeshComponent instance设置了UStaticMeshComponent的static mesh member variabl">
<meta property="og:type" content="article">
<meta property="og:title" content="UE5 Render a Cube">
<meta property="og:url" content="https://zhangzs11.github.io/2025/04/29/UE5Red-RenderACube/index.html">
<meta property="og:site_name" content="Canned Pixels">
<meta property="og:description" content="Data Structure and Relationships on the CPU SideCube Asset场景中的一个Cube的添加，engine做了:add一个StaticMeshActor到scene，这个actor包含了一个 UStaticMeshComponent instance设置了UStaticMeshComponent的static mesh member variabl">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://zhangzs11.github.io/img/MyAvatar.jpg">
<meta property="article:published_time" content="2025-04-29T07:15:44.473Z">
<meta property="article:modified_time" content="2025-04-30T06:10:10.087Z">
<meta property="article:author" content="Zishuai Zhang">
<meta property="article:tag" content="Computer Graphics, D3D, Game Engine Development">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://zhangzs11.github.io/img/MyAvatar.jpg"><link rel="shortcut icon" href="/img/MyAvatar.jpg"><link rel="canonical" href="https://zhangzs11.github.io/2025/04/29/UE5Red-RenderACube/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'UE5 Render a Cube',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  isShuoshuo: false
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background: linear-gradient(20deg, #b9fbc0, #98f5e1, #90dbf4, #cfbaf0);"></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/images/Funny/sunsetflower.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Canned Pixels</span></a><a class="nav-page-title" href="/"><span class="site-name">UE5 Render a Cube</span></a></span><div id="menus"></div></nav><div id="post-info"><h1 class="post-title">UE5 Render a Cube<a class="post-edit-link" href="null_posts/UE5Red-RenderACube.md" title="Edit" target="_blank"><i class="fas fa-pencil-alt"></i></a></h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2025-04-29T07:15:44.473Z" title="Created 2025-04-29 01:15:44">2025-04-29</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-04-30T06:10:10.087Z" title="Updated 2025-04-30 00:10:10">2025-04-30</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/UE5-Rendering/">UE5 Rendering</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="Data-Structure-and-Relationships-on-the-CPU-Side"><a href="#Data-Structure-and-Relationships-on-the-CPU-Side" class="headerlink" title="Data Structure and Relationships on the CPU Side"></a>Data Structure and Relationships on the CPU Side</h1><h2 id="Cube-Asset"><a href="#Cube-Asset" class="headerlink" title="Cube Asset"></a>Cube Asset</h2><p>场景中的一个Cube的添加，engine做了:add一个<strong>StaticMeshActor</strong>到scene，这个actor包含了一个 <strong>UStaticMeshComponent</strong> instance<br>设置了UStaticMeshComponent的<strong>static mesh member variable</strong>为cube static mesh<br>设置了UStaticMeshComponent的材质array的第一个为<strong>BasicShapeMaterial</strong>，也就是白色</p>
<div align="center">
  <img src="/images/UE5/cube1.1.1.png" alt="Game Screenshot">
  <p></p>
</div>

<p>还可以添加light影响渲染结果</p>
<h2 id="Asset-Branch"><a href="#Asset-Branch" class="headerlink" title="Asset Branch"></a>Asset Branch</h2><h3 id="Render-Data"><a href="#Render-Data" class="headerlink" title="Render Data"></a>Render Data</h3><p>Cube的渲染data包括:1. cube static mesh(<code>UStaticMesh</code>) 2. material(<code>UMaterial</code>)<br>More about Static Mesh: <a target="_blank" rel="noopener" href="https://docs.unrealengine.com/5.2/en-US/static-meshes/">https://docs.unrealengine.com/5.2/en-US/static-meshes/</a><br>More about Material: <a target="_blank" rel="noopener" href="https://docs.unrealengine.com/5.2/en-US/unreal-engine-materials/">https://docs.unrealengine.com/5.2/en-US/unreal-engine-materials/</a></p>
<h4 id="永久Persistent-数据"><a href="#永久Persistent-数据" class="headerlink" title="永久Persistent 数据"></a>永久Persistent 数据</h4><p>Mesh和Material都被永久序列化(permanently serialized)并存储在disk上<br>Mesh: 从外部DCC工具导出，然后import进engine用UE的importer，进行序列化并以uasset的形式存储<br>Material: 使用engine内的editor创建，然后同样序列化，以uasset的形式存储</p>
<h4 id="Save-and-Load"><a href="#Save-and-Load" class="headerlink" title="Save and Load"></a>Save and Load</h4><p>asset data在game loop开始之前load，或者引擎editor开始加载之前<br>对于static mesh,先从disk load， 然后创建一个<code>FStaticMeshRenderData</code>， 这个包含了LOD infos和vertex factories</p>
<div align="center">
  <img src="/images/UE5/cube1.2.1.png" alt="Game Screenshot">
  <p></p>
</div>

<h3 id="From-Material-to-Shaders"><a href="#From-Material-to-Shaders" class="headerlink" title="From Material to Shaders"></a>From Material to Shaders</h3><h3 id="From-Render-Data-to-Shader-Inputs"><a href="#From-Render-Data-to-Shader-Inputs" class="headerlink" title="From Render Data to Shader Inputs"></a>From Render Data to Shader Inputs</h3><h2 id="Runtime-Branch"><a href="#Runtime-Branch" class="headerlink" title="Runtime Branch"></a>Runtime Branch</h2><h3 id="Render-Proxy"><a href="#Render-Proxy" class="headerlink" title="Render Proxy"></a>Render Proxy</h3><p>Update and Sync between <strong>game thread</strong> and <strong>render thread</strong>:<br>game thread 更新gameplay逻辑，Mostly 通过tick functions. 然后capture 渲染相关的的信息到 <code>FRenderProxy</code> 然后sent to render thread</p>
<div align="center">
  <img src="/images/UE5/cube1.2.2.png" alt="Game Screenshot">
  <p></p>
</div>

<ol>
<li>Game world tick: our cube moved 3 cm forward</li>
<li>Capture: after the tick, we send this information to the FRenderProxy, by updating its transform info</li>
<li>Render thread update: since we need to render this frame, the render thread will <strong>update the new transform info to the GPU memory and ask GPU to render the cube based on the new transform info</strong>.</li>
<li>The cube appears at the new location, 3cm away from the last location</li>
<li>Our brain tell us, the cube has moved</li>
</ol>
<h4 id="mindmap-now"><a href="#mindmap-now" class="headerlink" title="mindmap now:"></a>mindmap now:</h4><div align="center">
  <img src="/images/UE5/cube1.2.3.png" alt="Game Screenshot">
  <p></p>
</div>

<p>So now the story becomes:</p>
<ul>
<li>The game thread updates the actors and components</li>
<li>After that, the game thread gets the <code>FStaticMeshSceneProxy</code> from our cube static mesh component</li>
<li>The game thread ask render thread to start rendering this frame.</li>
<li>The render thread takes the rendering data, both the <strong>runtime data (render proxies from components)</strong> and <strong>the common data (render datas from assets)</strong>, and <em>render the image</em>.</li>
</ul>
<h3 id="Mesh-Batches"><a href="#Mesh-Batches" class="headerlink" title="Mesh Batches"></a>Mesh Batches</h3><p>如果一个cube有多个<strong>materials</strong>, 我们需要 seperate the render proxy into <strong>mesh batches</strong><br>一个draw call不能同时use多个pixel shader,etc. 所以我们需要switch shaders 在这些materials之间，也就是需要多个draw call.<br>所以我们需要 <code>FMeshBatch</code> 这个structure处理mesh batch</p>
<div align="center">
  <img src="/images/UE5/cube1.2.4.png" alt="Game Screenshot">
  <p></p>
</div>

<p>So our story becomes:</p>
<ul>
<li>The render thread takes the rendering data, both the runtime data (render proxies from components) and the common data (render datas from assets), and render the image.<ul>
<li>For each <code>FStaticMeshSceneProxy</code><ul>
<li>Get many <code>FMeshBatch</code></li>
<li>For each <code>FMeshBatch</code><ul>
<li>Render <strong>this mesh batch</strong></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Next step:<br><strong>一个完整的渲染有多个pass</strong>，还需要根据不同pass去split切分 the Mesh Batch，引出接下来的level:<code>MeshDrawCommand</code></p>
<h3 id="Mesh-Draw-Commands"><a href="#Mesh-Draw-Commands" class="headerlink" title="Mesh Draw Commands"></a>Mesh Draw Commands</h3><h4 id="Multi-passes"><a href="#Multi-passes" class="headerlink" title="Multi-passes"></a>Multi-passes</h4><p>一次渲染需要多个pass，比如<br>our cube need to be rendered in both early Z pass for scene depth, and in base pass for GBuffer.</p>
<div align="center">
  <img src="/images/UE5/cube1.2.5.png" alt="Game Screenshot">
  <p></p>
</div>

<p>In other words, please imagine a table like this:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th></th>
<th></th>
<th>Early Z Pass</th>
<th>GBuffer Pass</th>
<th>Shadow Pass</th>
</tr>
</thead>
<tbody>
<tr>
<td>Mesh 0</td>
<td>Mesh Batch 0</td>
<td>Draw Call 0</td>
<td>Draw Call 1</td>
<td>Draw Call 2</td>
</tr>
<tr>
<td>Mesh 0</td>
<td>Mesh Batch 1</td>
<td>Draw Call 3</td>
<td>Draw Call 4</td>
<td>Draw Call 5</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>Why do we need to <strong>divide the Mesh into two Batches</strong>: Mesh Batch 0 and Mesh Batch 1?</li>
</ul>
<p>Because they have <strong>different materials</strong>, the shaders used for rendering such as GBufferPass may also be different.</p>
<ul>
<li>Why do we need to generate <strong>separate Draw Calls for each Pass</strong> for Mesh Batch 0?</li>
</ul>
<p>Because for the same Mesh, we have <strong>completely different drawing methods</strong> in different Passes:</p>
<ol>
<li>For the Early Z Pass, we only need to output depth.</li>
<li>For the GBuffer Pass, we need to output GBuffer data. Therefore, the bound Render Target must be switched.</li>
<li>For the Shadow Pass, our projection matrix will be completely different from 1 and 2.</li>
</ol>
<h4 id="Mesh-Draw-Command-and-Mesh-Pass-Processor"><a href="#Mesh-Draw-Command-and-Mesh-Pass-Processor" class="headerlink" title="Mesh Draw Command and Mesh Pass Processor"></a>Mesh Draw Command and Mesh Pass Processor</h4><p>尽管有时候我们只有single <code>FMeshBatch</code>,也需要generate <strong>more than one draw call</strong>. 需要在<strong>somewhere 保存每个draw call相关的信息</strong>,<code>叫做FMeshDrawCommand</code><br>需要<code>FMeshPassProcessor</code>负责为每个不同的<strong>pass</strong>生成<code>FMeshDrawCommand</code></p>
<div align="center">
  <img src="/images/UE5/cube1.2.6.png" alt="Game Screenshot">
  <p></p>
</div>

<p>So our story becomes:</p>
<ul>
<li>The render thread takes the rendering data, including both the runtime data (render proxies from components) and the common data (render data from assets), and uses it to render the image.<ul>
<li>For each <code>FStaticMeshSceneProxy</code>:<ul>
<li>Retrieve many <code>FMeshBatch</code> objects.</li>
<li>For each <code>FMeshBatch</code>:<ul>
<li>Build mesh draw commands for each pass.</li>
</ul>
</li>
</ul>
</li>
<li>For each pass, merge all the draw commands that belong to this pass.</li>
<li>For each pass:<ul>
<li>Execute the related <code>FMeshDrawCommand</code> list.</li>
</ul>
</li>
</ul>
</li>
</ul>
<div align="center">
  <img src="/images/UE5/cube1.2.7.png" alt="Game Screenshot">
  <p></p>
</div>

<p>相当于不同mesh的相同的pass放在一块儿了，一块执行这些功能相同的pass</p>
<p>For our cube, we have 2 FMeshDrawCommand, one for Depth Prepass, anther one for Base Pass.</p>
<h4 id="Question-now"><a href="#Question-now" class="headerlink" title="Question now"></a>Question now</h4><p>how do we map the information of the <strong>MeshDrawCommand</strong> to the <strong>rendering API requests</strong>?</p>
<ul>
<li>How to correctly <strong>set up the Shader</strong> for drawing?</li>
<li>How to set the <strong>Material-related parameters</strong> to the rendering <strong>pipeline</strong>?<br>This leads us to the next section: <strong><em>RHI layer</em></strong>.</li>
</ul>
<h3 id="RHI-Command-List"><a href="#RHI-Command-List" class="headerlink" title="RHI Command List"></a>RHI Command List</h3><p>RHI stands for “Rendering Hardware Interface”. 是各种平台图形API的抽象层(D3D, Vulkan). 相当于一个mapping to the graphics API。<br>For example, <code>RHIDrawIndexedPrimitive</code> can be treated as <code>DrawIndexedInstanced</code>.</p>
<h4 id="From-Mesh-Draw-Command-to-RHI"><a href="#From-Mesh-Draw-Command-to-RHI" class="headerlink" title="From Mesh Draw Command to RHI"></a>From Mesh Draw Command to RHI</h4><p>对于每个<code>FMeshDrawCommand</code>, 我们应该add到一个 <code>RHICommandList</code>. 这个list之后会被送到RHI thread并执行</p>
<div align="center">
  <img src="/images/UE5/cube1.2.8.png" alt="Game Screenshot">
  <p></p>
</div>

<p>In our one cube, and the depth pass, it generates the following commands:</p>
<div align="center">
  <img src="/images/UE5/cube1.2.9.png" alt="Game Screenshot">
  <p></p>
</div>

<p>So our story becomes:</p>
<ul>
<li>The render thread takes the rendering data, including both the runtime data (render proxies from components) and the common data (render data from assets), and uses it to render the image.<ul>
<li>For each <code>FStaticMeshSceneProxy</code>:<ul>
<li>Retrieve many <code>FMeshBatch</code> objects.</li>
<li>For each <code>FMeshBatch</code>:<ul>
<li>Build mesh draw commands for each pass.</li>
</ul>
</li>
</ul>
</li>
<li>For each pass, merge all the draw commands that belong to this pass.</li>
<li>For each pass:<ul>
<li>Execute the related <code>FMeshDrawCommand</code> list.<ul>
<li>Convert the mesh draw command into a set of <code>RHICommand</code></li>
<li>Add those commands to RHI command list</li>
<li>Send the list to RHI thread</li>
</ul>
</li>
</ul>
</li>
<li>The RHI thread take the command list, and execute.</li>
</ul>
</li>
</ul>
<p>So let me show a summary image to conclude from FMeshBatch to FMeshDrawCommand and then to RHICommand.</p>
<div align="center">
  <img src="/images/UE5/cube1.2.10.png" alt="Game Screenshot">
  <p></p>
</div>

<h3 id="GPU-Rendering"><a href="#GPU-Rendering" class="headerlink" title="GPU Rendering"></a>GPU Rendering</h3><p>now it’s <strong>the lowest part</strong>. The GPU will execute <strong>the graphcis API mapped from RHI commands</strong>.</p>
<div align="center">
  <img src="/images/UE5/cube1.2.11.png" alt="Game Screenshot">
  <p></p>
</div>

<p>After executed all the commands in the current frame, we will see this content in the final frame render target texture.</p>
<div align="center">
  <img src="/images/UE5/cube1.2.12.png" alt="Game Screenshot">
  <p></p>
</div>

<h4 id="Questions-for-the-Next"><a href="#Questions-for-the-Next" class="headerlink" title="Questions for the Next"></a>Questions for the Next</h4><p>Is this the end? Of course not, there are many unanswered questions:</p>
<ul>
<li>Where do the shaders come from?</li>
<li>How do materials affect rendering?</li>
<li>Where does the vertex data come from?</li>
<li>…</li>
</ul>
<h1 id="Process-of-One-Pass"><a href="#Process-of-One-Pass" class="headerlink" title="Process of One Pass"></a>Process of One Pass</h1><h1 id="Deferred-Renderer"><a href="#Deferred-Renderer" class="headerlink" title="Deferred Renderer"></a>Deferred Renderer</h1></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://zhangzs11.github.io">Zishuai Zhang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://zhangzs11.github.io/2025/04/29/UE5Red-RenderACube/">https://zhangzs11.github.io/2025/04/29/UE5Red-RenderACube/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="/img/MyAvatar.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related full-width" href="/2025/04/24/UE5Red-WholePipeline/" title="UE5 General Whole Rendering pipeline"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">UE5 General Whole Rendering pipeline</div></div><div class="info-2"><div class="info-item-1">FXSystemPreRenderBuildRendering CommandsDeferred CullInstances(Generic)  PrePass DepthPassParallel  RenderVelocities velocityParallel  NaniteVisibilityBuffer DrawGeometry  NaniteEmitDepthTargets Emit Scene Depth/Resolve/Velocity Emit Scene Stencil Emit Material Depth  ComputeLightGridHierarchical Z-Buffer BuildHZB  SkyAtmosphereLUTsLumenSceneUpdate NaniteRasterizeLumenCards NaniteDrawLumenMeshCapturePass CopyCardsToSurfaceCache  CompositionBeforeBasePass DeferredDecals BeforeBasePass...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/MyAvatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Zishuai Zhang</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">42</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">7</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/zhangzs11" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:zhangzs2023@163.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Data-Structure-and-Relationships-on-the-CPU-Side"><span class="toc-number">1.</span> <span class="toc-text">Data Structure and Relationships on the CPU Side</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Cube-Asset"><span class="toc-number">1.1.</span> <span class="toc-text">Cube Asset</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Asset-Branch"><span class="toc-number">1.2.</span> <span class="toc-text">Asset Branch</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Render-Data"><span class="toc-number">1.2.1.</span> <span class="toc-text">Render Data</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B0%B8%E4%B9%85Persistent-%E6%95%B0%E6%8D%AE"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">永久Persistent 数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Save-and-Load"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">Save and Load</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#From-Material-to-Shaders"><span class="toc-number">1.2.2.</span> <span class="toc-text">From Material to Shaders</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#From-Render-Data-to-Shader-Inputs"><span class="toc-number">1.2.3.</span> <span class="toc-text">From Render Data to Shader Inputs</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Runtime-Branch"><span class="toc-number">1.3.</span> <span class="toc-text">Runtime Branch</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Render-Proxy"><span class="toc-number">1.3.1.</span> <span class="toc-text">Render Proxy</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#mindmap-now"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">mindmap now:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mesh-Batches"><span class="toc-number">1.3.2.</span> <span class="toc-text">Mesh Batches</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mesh-Draw-Commands"><span class="toc-number">1.3.3.</span> <span class="toc-text">Mesh Draw Commands</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Multi-passes"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">Multi-passes</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Mesh-Draw-Command-and-Mesh-Pass-Processor"><span class="toc-number">1.3.3.2.</span> <span class="toc-text">Mesh Draw Command and Mesh Pass Processor</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Question-now"><span class="toc-number">1.3.3.3.</span> <span class="toc-text">Question now</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RHI-Command-List"><span class="toc-number">1.3.4.</span> <span class="toc-text">RHI Command List</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#From-Mesh-Draw-Command-to-RHI"><span class="toc-number">1.3.4.1.</span> <span class="toc-text">From Mesh Draw Command to RHI</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GPU-Rendering"><span class="toc-number">1.3.5.</span> <span class="toc-text">GPU Rendering</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Questions-for-the-Next"><span class="toc-number">1.3.5.1.</span> <span class="toc-text">Questions for the Next</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Process-of-One-Pass"><span class="toc-number">2.</span> <span class="toc-text">Process of One Pass</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Deferred-Renderer"><span class="toc-number">3.</span> <span class="toc-text">Deferred Renderer</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/29/UE5Red-RenderACube/" title="UE5 Render a Cube">UE5 Render a Cube</a><time datetime="2025-04-29T07:15:44.473Z" title="Created 2025-04-29 01:15:44">2025-04-29</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/24/UE5Red-WholePipeline/" title="UE5 General Whole Rendering pipeline">UE5 General Whole Rendering pipeline</a><time datetime="2025-04-24T10:59:35.159Z" title="Created 2025-04-24 04:59:35">2025-04-24</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/12/UE5Red-DeferredRendering/" title="UE5 Deferred Rendering pipeline">UE5 Deferred Rendering pipeline</a><time datetime="2025-04-12T19:26:52.592Z" title="Created 2025-04-12 13:26:52">2025-04-12</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/01/20/GraphicsSystem-DeferredRendering/" title="GraphicsSystem-Deferred Rendering">GraphicsSystem-Deferred Rendering</a><time datetime="2025-01-20T21:05:08.640Z" title="Created 2025-01-20 14:05:08">2025-01-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/01/18/GraphicsSystem-FXAA/" title="GraphicsSystem-Anti-Aliasing">GraphicsSystem-Anti-Aliasing</a><time datetime="2025-01-19T05:19:14.585Z" title="Created 2025-01-18 22:19:14">2025-01-18</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2025 By Zishuai Zhang</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(() => {
  const loadMathjax = () => {
    if (!window.MathJax) {
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          tags: 'none',
        },
        chtml: {
          scale: 1.1
        },
        options: {
          enableMenu: true,
          renderActions: {
            findScript: [10, doc => {
              for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
                const display = !!node.type.match(/; *mode=display/)
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
                const text = document.createTextNode('')
                node.parentNode.replaceChild(text, node)
                math.start = {node: text, delim: '', n: 0}
                math.end = {node: text, delim: '', n: 0}
                doc.math.push(math)
              }
            }, '']
          }
        }
      }
      
      const script = document.createElement('script')
      script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
      script.id = 'MathJax-script'
      script.async = true
      document.head.appendChild(script)
    } else {
      MathJax.startup.document.state(0)
      MathJax.texReset()
      MathJax.typesetPromise()
    }
  }

  btf.addGlobalFn('encrypt', loadMathjax, 'mathjax')
  window.pjax ? loadMathjax() : window.addEventListener('load', loadMathjax)
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>