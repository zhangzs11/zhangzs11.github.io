<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Game AI in C++ with openFrameworks - Decision-Making Part (I) - Behaviour Tree | Canned Pixels</title><meta name="author" content="Zishuai Zhang,zhangzs2023@163.com"><meta name="copyright" content="Zishuai Zhang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="BehaviourTree ClassCode123456789101112131415class BehaviourTree &#123;private:    Task* root;    Blackboard* blackboard;    Tick* tick;public:    BehaviourTree(Task* root, Blackboard* blackboard, Tick">
<meta property="og:type" content="article">
<meta property="og:title" content="Game AI in C++ with openFrameworks - Decision-Making Part (I) - Behaviour Tree">
<meta property="og:url" content="https://zhangzs11.github.io/2024/07/25/Game%20AI%20in%20C++%20with%20openFrameworks%20-%20Behaviour%20Tree/index.html">
<meta property="og:site_name" content="Canned Pixels">
<meta property="og:description" content="BehaviourTree ClassCode123456789101112131415class BehaviourTree &#123;private:    Task* root;    Blackboard* blackboard;    Tick* tick;public:    BehaviourTree(Task* root, Blackboard* blackboard, Tick">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://zhangzs11.github.io/img/MyAvatar.jpg">
<meta property="article:published_time" content="2024-07-25T06:00:00.000Z">
<meta property="article:modified_time" content="2024-12-16T09:48:40.261Z">
<meta property="article:author" content="Zishuai Zhang">
<meta property="article:tag" content="Computer Graphics, D3D, Game Engine Development">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://zhangzs11.github.io/img/MyAvatar.jpg"><link rel="shortcut icon" href="/img/MyAvatar.jpg"><link rel="canonical" href="https://zhangzs11.github.io/2024/07/25/Game%20AI%20in%20C++%20with%20openFrameworks%20-%20Behaviour%20Tree/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Game AI in C++ with openFrameworks - Decision-Making Part (I) - Behaviour Tree',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  isShuoshuo: false
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background: linear-gradient(20deg, #b9fbc0, #98f5e1, #90dbf4, #cfbaf0);"></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/images/Funny/doc_room_pixel.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Canned Pixels</span></a><a class="nav-page-title" href="/"><span class="site-name">Game AI in C++ with openFrameworks - Decision-Making Part (I) - Behaviour Tree</span></a></span><div id="menus"></div></nav><div id="post-info"><h1 class="post-title">Game AI in C++ with openFrameworks - Decision-Making Part (I) - Behaviour Tree<a class="post-edit-link" href="null_posts/Game AI in C++ with openFrameworks - Behaviour Tree.md" title="Edit" target="_blank"><i class="fas fa-pencil-alt"></i></a></h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2024-07-25T06:00:00.000Z" title="Created 2024-07-25 00:00:00">2024-07-25</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2024-12-16T09:48:40.261Z" title="Updated 2024-12-16 02:48:40">2024-12-16</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Game-AI/">Game AI</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="BehaviourTree-Class"><a href="#BehaviourTree-Class" class="headerlink" title="BehaviourTree Class"></a>BehaviourTree Class</h1><h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BehaviourTree</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Task* root;</span><br><span class="line">    Blackboard* blackboard;</span><br><span class="line">    Tick* tick;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">BehaviourTree</span>(Task* root, Blackboard* blackboard, Tick* tick) : <span class="built_in">root</span>(root), <span class="built_in">blackboard</span>(blackboard), <span class="built_in">tick</span>(tick) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">Status <span class="title">makeDecision</span><span class="params">(<span class="type">float</span> deltaTime)</span> </span>&#123;</span><br><span class="line">        Status result;</span><br><span class="line">        result = root-&gt;<span class="built_in">run</span>(*tick);</span><br><span class="line">        tick-&gt;frameTime = deltaTime;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="Components"><a href="#Components" class="headerlink" title="Components"></a>Components</h2><p><strong>1. Task root:</strong><br>This represents the root node of the behavior tree. The root is the entry point, and <strong>every frame, the behavior tree starts executing from this node</strong>. The tree structure is built by connecting various tasks (nodes) under this root node, forming a hierarchy.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Task</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Task</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> Status <span class="title">run</span><span class="params">(Tick&amp; tick)</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RootTask</span> : <span class="keyword">public</span> Task &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Task* child;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">RootTask</span>(Task* child) : <span class="built_in">child</span>(child) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">RootTask</span>() &#123;</span><br><span class="line">        <span class="keyword">delete</span> child;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">Status <span class="title">run</span><span class="params">(Tick&amp; tick)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (child != <span class="literal">nullptr</span>) &#123;</span><br><span class="line">            tick.<span class="built_in">open</span>(*child);</span><br><span class="line">            Status status = tick.<span class="built_in">execute</span>();</span><br><span class="line">            tick.<span class="built_in">close</span>();</span><br><span class="line">            <span class="keyword">return</span> status;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Status::Failure;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>2. Blackboard :</strong><br>The blackboard serves as a <strong>shared memory space</strong> where data can be stored and accessed by different nodes. This allows for communication between different parts of the behavior tree, as well as between the AI system and other game systems. For instance, it can store the character’s current target, positions, or status flags, making it easier for nodes to access relevant information.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Blackboard</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    std::unordered_map&lt;std::string, std::any&gt; data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Blackboard</span>() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">set</span><span class="params">(<span class="type">const</span> std::string&amp; key, <span class="type">const</span> std::any&amp; value)</span> </span>&#123; data[key] = value; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">std::any <span class="title">get</span><span class="params">(<span class="type">const</span> std::string&amp; key)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">auto</span> it = data.<span class="built_in">find</span>(key);</span><br><span class="line">        <span class="keyword">if</span> (it != data.<span class="built_in">end</span>()) &#123;</span><br><span class="line">            <span class="keyword">return</span> it-&gt;second;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function">    T <span class="title">get</span><span class="params">(<span class="type">const</span> std::string&amp; key, <span class="type">const</span> T&amp; defaultValue)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">auto</span> it = data.<span class="built_in">find</span>(key);</span><br><span class="line">        <span class="keyword">if</span> (it != data.<span class="built_in">end</span>()) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> std::<span class="built_in">any_cast</span>&lt;T&gt;(it-&gt;second);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">catch</span> (<span class="type">const</span> std::bad_any_cast&amp;) &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> defaultValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">const</span> std::unordered_map&lt;std::string, std::any&gt;&amp; <span class="title">getData</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> data; &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<div align="center">
  <img src="/images/GameAIDemo/BlackBoard.gif" alt="Game Screenshot">
  <p>Blackboard data while the Demo is running</p>
</div>

<p><strong>3. Tick :</strong><br>A Tick object manages the execution state of the behavior tree. It carries essential information, such as the <strong>current node being processed</strong> and the <strong>time elapsed per frame</strong> (deltaTime). It also helps in <strong>setting and retrieving data from the blackboard during execution</strong>. The tick ensures that the behavior tree processes smoothly across frames, even if some nodes require multiple frames to complete.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Tick</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    Blackboard* bb;</span><br><span class="line">    Status currentStatus = Status::Running;</span><br><span class="line">    Task* currentTask = <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="type">float</span> frameTime;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Tick</span>(Blackboard* bb) : <span class="built_in">bb</span>(bb) &#123;&#125;</span><br><span class="line">    <span class="function"><span class="type">float</span> <span class="title">getFrameTime</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> frameTime; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">open</span><span class="params">(Task&amp; t)</span> </span>&#123; currentTask = &amp;t; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123; currentTask = <span class="literal">nullptr</span>; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setStatus</span><span class="params">(Status status)</span> </span>&#123; currentStatus = status; &#125;</span><br><span class="line">    <span class="function">Status <span class="title">getStatus</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> currentStatus; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setData</span><span class="params">(<span class="type">const</span> std::string&amp; key, <span class="type">const</span> std::any&amp; value)</span> </span>&#123; bb-&gt;<span class="built_in">set</span>(key, value); &#125;</span><br><span class="line">    <span class="function">std::any <span class="title">getData</span><span class="params">(<span class="type">const</span> std::string&amp; key)</span> </span>&#123; <span class="keyword">return</span> bb-&gt;<span class="built_in">get</span>(key); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">Status <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        currentStatus = currentTask-&gt;<span class="built_in">run</span>(*<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">return</span> currentStatus;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h1 id="Each-Node-returns-a-Status"><a href="#Each-Node-returns-a-Status" class="headerlink" title="Each Node returns a Status"></a>Each Node returns a Status</h1><p>In a behavior tree, each node returns a status to indicate the outcome of its execution. These statuses are essential for controlling the flow of execution and determining how parent nodes should proceed. The Status enumeration can be defined as follows:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum class</span> <span class="title class_">Status</span> &#123;</span><br><span class="line">    Success,</span><br><span class="line">    Failure,</span><br><span class="line">    Running,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>Success: Indicates that the node has completed its task successfully.</li>
<li>Failure: Indicates that the node was unable to complete its task.</li>
<li>Running: Means that the node is still executing and has not yet completed.</li>
</ul>
<h2 id="How-Status-Affects-Node-Execution"><a href="#How-Status-Affects-Node-Execution" class="headerlink" title="How Status Affects Node Execution"></a>How Status Affects Node Execution</h2><p>The returned status from each node is critical because it determines the behavior of the parent nodes, especially control nodes like Sequence or Selector. Here is an example how this works:<br><strong><em>Example: SequenceNode Execution Logic</em></strong><br>A SequenceNode is designed to <strong>execute its children in order</strong>, from the first to the last. It will:</p>
<ol>
<li>Start with the first child:<br>If it returns Success, the SequenceNode will proceed to the next child.</li>
<li>If a child returns Running:</li>
</ol>
<ul>
<li>The SequenceNode will remember this child’s index and exit with a Running status.</li>
<li>On the next frame, when the SequenceNode is processed again, it will resume from the last running child instead of starting over. This way, the SequenceNode can handle tasks that need to span multiple frames.</li>
</ul>
<ol start="3">
<li>If a child returns Failure:<br>The SequenceNode will stop immediately, return Failure to its parent, and not execute any of the remaining children.<br>This indicates that the sequence could not complete its intended operation.</li>
</ol>
<h2 id="Why-This-Approach-Matters"><a href="#Why-This-Approach-Matters" class="headerlink" title="Why This Approach Matters"></a>Why This Approach Matters</h2><p>This design allows the behavior tree to handle tasks that need to be <strong>interrupted or paused</strong> (like rendering) between frames. For example, consider a sequence where a character:</p>
<ol>
<li>Finds a path to the target.</li>
<li>Moves along the path.</li>
<li>Attacks the target once within range.</li>
</ol>
<p>If the movement to the target takes <strong>several frames</strong>, the Move node will <strong>keep returning Running</strong>. The SequenceNode will then “pause” the sequence and <strong>continue from the Move node in the next frame</strong>, ensuring smooth and logical task management.</p>
<h1 id="Action-and-ActionNode"><a href="#Action-and-ActionNode" class="headerlink" title="Action and ActionNode"></a>Action and ActionNode</h1><p>In a behavior tree, action nodes <strong>represent the leaves of the tree, where actual actions are performed</strong>. These actions can be anything from moving a character, playing an animation, or changing a game object’s color. The <strong>BTAction</strong> and <strong>BTActionNode</strong> classes help to implement this concept.</p>
<h2 id="BTAction-Class"><a href="#BTAction-Class" class="headerlink" title="BTAction Class"></a><em>BTAction</em> Class</h2><p>The BTAction class is <strong>an abstract base class</strong> that defines a common <strong>interface for all actions</strong>. Each action inherits from BTAction and implements the perform method, which defines the specific behavior of that action.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BTAction</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">BTAction</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> Status <span class="title">perform</span><span class="params">(Tick&amp; tick)</span> </span>= <span class="number">0</span>; <span class="comment">// Executes the specific action and returns the result</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="BTActionNode-Class"><a href="#BTActionNode-Class" class="headerlink" title="BTActionNode Class"></a><em>BTActionNode</em> Class</h2><p>The BTActionNode class is a type of Task that holds a pointer to a BTAction object. It <strong>acts as a bridge between the behavior tree and the specific action</strong> it should perform.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BTActionNode</span> : <span class="keyword">public</span> Task &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    BTAction* action; <span class="comment">// Holds a pointer to an Action object</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">BTActionNode</span>(BTAction* action) : <span class="built_in">action</span>(action) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">BTActionNode</span>() &#123;</span><br><span class="line">        <span class="keyword">delete</span> action;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">Status <span class="title">run</span><span class="params">(Tick&amp; tick)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (action) &#123;</span><br><span class="line">            <span class="keyword">return</span> action-&gt;<span class="built_in">perform</span>(tick); <span class="comment">// Calls the Action&#x27;s perform method</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Status::Error;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="Example-BTChangeColorAction"><a href="#Example-BTChangeColorAction" class="headerlink" title="Example: BTChangeColorAction"></a><em>Example</em>: BTChangeColorAction</h2><p>To demonstrate how these classes work together, let’s look at an example action: BTChangeColorAction. This action is responsible for changing the color of a character.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BTChangeColorAction</span> : <span class="keyword">public</span> BTAction &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    ofColor color;</span><br><span class="line">    <span class="built_in">BTChangeColorAction</span>(ofColor color) : <span class="built_in">color</span>(color) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">Status <span class="title">perform</span><span class="params">(Tick&amp; tick)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">auto</span>* monster = std::<span class="built_in">any_cast</span>&lt;Character*&gt;(tick.<span class="built_in">getData</span>(<span class="string">&quot;monster&quot;</span>));</span><br><span class="line">        <span class="keyword">if</span> (!monster) &#123;</span><br><span class="line">            std::cerr &lt;&lt; <span class="string">&quot;BTChangeColorAction failed: monster is null.&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">            <span class="keyword">return</span> Status::Failure;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        monster-&gt;color = color;</span><br><span class="line">        tick.<span class="built_in">setData</span>(<span class="string">&quot;currentAction&quot;</span>, std::<span class="built_in">string</span>(<span class="string">&quot;Change Color&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> Status::Success;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h1 id="Control-nodes"><a href="#Control-nodes" class="headerlink" title="Control nodes"></a>Control nodes</h1><p>In behavior trees, control nodes play a crucial role <strong>in determining the flow of execution</strong>. They decide <strong>which child nodes to run and how to handle the results from those childr</strong>en. Here, I’ll introduce three common types of control nodes: BTSelectorNode, BTSequenceNode, and BTNondeterministicSelectorNode.</p>
<h2 id="SelectorNode"><a href="#SelectorNode" class="headerlink" title="SelectorNode"></a>SelectorNode</h2><p>A SelectorNode (sometimes called a “Fallback” node) attempts to <strong>execute its children one by one until it finds one that succeeds or is still running</strong>. If all children fail, the BTSelectorNode returns Failure.</p>
<h3 id="Key-Behavior"><a href="#Key-Behavior" class="headerlink" title="Key Behavior:"></a>Key Behavior:</h3><ul>
<li><strong>Execution Order:</strong> It starts from the first child and moves sequentially to the next.</li>
<li><strong>Stops on Success or Running:</strong> If any child returns Success or Running, the BTSelectorNode stops and returns that status.</li>
<li><strong>Returns Failure:</strong> If all children return Failure, it returns Failure to the parent.</li>
</ul>
<h3 id="Code-1"><a href="#Code-1" class="headerlink" title="Code:"></a>Code:</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BTSelectorNode</span> : <span class="keyword">public</span> Task &#123;</span><br><span class="line">    std::vector&lt;Task*&gt; children;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addChild</span><span class="params">(Task* child)</span> </span>&#123;</span><br><span class="line">        children.<span class="built_in">push_back</span>(child);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Status <span class="title">run</span><span class="params">(Tick&amp; tick)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; child : children) &#123;</span><br><span class="line">            tick.<span class="built_in">open</span>(*child);</span><br><span class="line">            Status status = tick.<span class="built_in">execute</span>();</span><br><span class="line">            <span class="keyword">if</span> (status != Status::Failure) &#123;</span><br><span class="line">                tick.<span class="built_in">close</span>(); <span class="comment">// Stop executing further children if one succeeds or is running</span></span><br><span class="line">                <span class="keyword">return</span> status;</span><br><span class="line">            &#125;</span><br><span class="line">            tick.<span class="built_in">close</span>(); <span class="comment">// Close child if it fails</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Status::Failure; <span class="comment">// Return Failure if all children fail</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="SequenceNode"><a href="#SequenceNode" class="headerlink" title="SequenceNode"></a>SequenceNode</h2><p>A BTSequenceNode <strong>runs each of its children in sequence, from the first to the last</strong>. If any child returns Failure, the BTSequenceNode stops and returns Failure. If all children return Success, the BTSequenceNode returns Success.</p>
<h3 id="Key-Behavior-1"><a href="#Key-Behavior-1" class="headerlink" title="Key Behavior:"></a>Key Behavior:</h3><ul>
<li><strong>Execution Order:</strong> Executes each child in order.</li>
<li><strong>Stops on Failure:</strong> If any child fails, it stops and returns Failure.</li>
<li><strong>Maintains Index for Running:</strong> If a child is still Running, it remembers this index and will resume from this child in the next frame.</li>
<li><strong>Returns Success:</strong> Only if all children succeed.</li>
</ul>
<h3 id="Code-2"><a href="#Code-2" class="headerlink" title="Code:"></a>Code:</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BTSequenceNode</span> : <span class="keyword">public</span> Task &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::vector&lt;Task*&gt; children;</span><br><span class="line">    <span class="type">int</span> currentChildIndex = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addChild</span><span class="params">(Task* child)</span> </span>&#123;</span><br><span class="line">        children.<span class="built_in">push_back</span>(child);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Status <span class="title">run</span><span class="params">(Tick&amp; tick)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Resume from the last running node</span></span><br><span class="line">        <span class="keyword">while</span> (currentChildIndex &lt; children.<span class="built_in">size</span>()) &#123;</span><br><span class="line">            Task* child = children[currentChildIndex];</span><br><span class="line">            tick.<span class="built_in">open</span>(*child);</span><br><span class="line">            Status status = tick.<span class="built_in">execute</span>();</span><br><span class="line">            tick.<span class="built_in">close</span>();</span><br><span class="line">            <span class="keyword">if</span> (status == Status::Running) &#123;</span><br><span class="line">                <span class="keyword">return</span> Status::Running; <span class="comment">// Continue running the current child</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (status != Status::Success) &#123;</span><br><span class="line">                currentChildIndex = <span class="number">0</span>; <span class="comment">// Reset when a child fails</span></span><br><span class="line">                <span class="keyword">return</span> status; <span class="comment">// Return failure or error</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// Move to the next child if the current one succeeds</span></span><br><span class="line">            currentChildIndex++;</span><br><span class="line">        &#125;</span><br><span class="line">        currentChildIndex = <span class="number">0</span>; <span class="comment">// Reset when all children succeed</span></span><br><span class="line">        <span class="keyword">return</span> Status::Success; <span class="comment">// All children have succeeded</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="NondeterministicSelectorNode"><a href="#NondeterministicSelectorNode" class="headerlink" title="NondeterministicSelectorNode"></a>NondeterministicSelectorNode</h2><p>The BTNondeterministicSelectorNode is a variation of the selector node that <strong>selects its child to execute based on weighted probabilities</strong>. This node introduces randomness, allowing different behaviors to be chosen each time it runs, depending on the weights assigned to the children.</p>
<h3 id="Key-Behavior-2"><a href="#Key-Behavior-2" class="headerlink" title="Key Behavior:"></a>Key Behavior:</h3><ul>
<li><strong>Random Selection:</strong> Uses weights to determine the likelihood of selecting each child.</li>
<li><strong>Single Execution:</strong> Executes the chosen child once and returns its status.</li>
<li><strong>Weighted Probability:</strong> Children with higher weights have a higher chance of being selected.</li>
</ul>
<h3 id="Code-3"><a href="#Code-3" class="headerlink" title="Code:"></a>Code:</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BTNondeterministicSelectorNode</span> : <span class="keyword">public</span> Task &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::vector&lt;Task*&gt; children;</span><br><span class="line">    std::vector&lt;<span class="type">double</span>&gt; weights;</span><br><span class="line">    std::discrete_distribution&lt;&gt; distribution;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addChild</span><span class="params">(Task* child, <span class="type">double</span> weight)</span> </span>&#123;</span><br><span class="line">        children.<span class="built_in">push_back</span>(child);</span><br><span class="line">        weights.<span class="built_in">push_back</span>(weight);</span><br><span class="line">        <span class="built_in">updateDistribution</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">updateDistribution</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!weights.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            distribution = std::discrete_distribution&lt;&gt;(weights.<span class="built_in">begin</span>(), weights.<span class="built_in">end</span>());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Status <span class="title">run</span><span class="params">(Tick&amp; tick)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (children.<span class="built_in">empty</span>()) <span class="keyword">return</span> Status::Failure;</span><br><span class="line"></span><br><span class="line">        std::random_device rd;</span><br><span class="line">        <span class="function">std::mt19937 <span class="title">gen</span><span class="params">(rd())</span></span>;</span><br><span class="line">        <span class="type">int</span> chosenIndex = <span class="built_in">distribution</span>(gen);</span><br><span class="line"></span><br><span class="line">        tick.<span class="built_in">open</span>(*children[chosenIndex]);</span><br><span class="line">        Status result = tick.<span class="built_in">execute</span>();</span><br><span class="line">        tick.<span class="built_in">close</span>();</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h1 id="Decorator-Nodes"><a href="#Decorator-Nodes" class="headerlink" title="Decorator Nodes"></a>Decorator Nodes</h1><p>In a behavior tree, decorator nodes are used to <strong>modify or control the behavior of their child nodes</strong>. They can change the way child nodes operate, either by <strong>repeating actions, inverting their outcomes, or checking conditions before allowing them to run</strong>. Here, I’ll introduce three types of decorator nodes: <em>BTRepeatUntilFailNode, BTInverterNode, and BTConditionalDecoratorNode</em>.</p>
<h2 id="DecoratorNode-The-Base-Class"><a href="#DecoratorNode-The-Base-Class" class="headerlink" title="DecoratorNode - The Base Class"></a>DecoratorNode - The Base Class</h2><p>The BTDecoratorNode is a base class for all decorator nodes. It <strong>holds a single child node</strong></p>
<h3 id="code"><a href="#code" class="headerlink" title="code"></a>code</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BTDecoratorNode</span> : <span class="keyword">public</span> Task &#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    Task* child;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">BTDecoratorNode</span>(Task* child) : <span class="built_in">child</span>(child) &#123;&#125;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">BTDecoratorNode</span>() &#123;</span><br><span class="line">        <span class="keyword">delete</span> child;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="RepeatUntilFailNode"><a href="#RepeatUntilFailNode" class="headerlink" title="RepeatUntilFailNode"></a>RepeatUntilFailNode</h2><p>The BTRepeatUntilFailNode repeatedly <strong>executes its child node until the child returns Failure</strong>. It is useful for tasks that should keep running until a specific condition causes them to stop.</p>
<h3 id="code-1"><a href="#code-1" class="headerlink" title="code"></a>code</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BTRepeatUntilFailNode</span> : <span class="keyword">public</span> BTDecoratorNode &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">BTRepeatUntilFailNode</span>(Task* child) : <span class="built_in">BTDecoratorNode</span>(child) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">Status <span class="title">run</span><span class="params">(Tick&amp; tick)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Execute the child task</span></span><br><span class="line">        tick.<span class="built_in">open</span>(*child);</span><br><span class="line">        Status status = tick.<span class="built_in">execute</span>();</span><br><span class="line">        tick.<span class="built_in">close</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (status != Status::Success) &#123;</span><br><span class="line">            <span class="keyword">return</span> Status::Failure;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Return running after each successful execution to allow for frame-by-frame processing</span></span><br><span class="line">        <span class="keyword">return</span> Status::Running;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="Key-Behavior-3"><a href="#Key-Behavior-3" class="headerlink" title="Key Behavior:"></a>Key Behavior:</h3><ul>
<li><strong>Repeat Execution:</strong> Continues to run the child node frame-by-frame as long as the child succeeds.</li>
<li><strong>Stops on Failure:</strong> If the child returns Failure, the decorator node stops and returns Failure.</li>
<li><strong>Returns Running:</strong> After each successful execution, it returns Running to allow for frame-by-frame processing.</li>
</ul>
<h2 id="ConditionalDecoratorNode"><a href="#ConditionalDecoratorNode" class="headerlink" title="ConditionalDecoratorNode"></a>ConditionalDecoratorNode</h2><p>The BTConditionalDecoratorNode <strong>only allows its child node to run if a specific condition is met</strong>. This decorator is <strong><em>abstract</em></strong>, meaning you need to inherit from it and define the condition function to create specific behaviors.</p>
<h3 id="code-2"><a href="#code-2" class="headerlink" title="code"></a>code</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BTConditionalDecoratorNode</span> : <span class="keyword">public</span> BTDecoratorNode &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">BTConditionalDecoratorNode</span>(Task* child) : <span class="built_in">BTDecoratorNode</span>(child) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">bool</span> <span class="title">condition</span><span class="params">(Tick&amp; tick)</span> </span>= <span class="number">0</span>;  <span class="comment">// Must be implemented by derived classes</span></span><br><span class="line"></span><br><span class="line">    <span class="function">Status <span class="title">run</span><span class="params">(Tick&amp; tick)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">condition</span>(tick)) &#123;</span><br><span class="line">            tick.<span class="built_in">open</span>(*child);</span><br><span class="line">            Status status = tick.<span class="built_in">execute</span>();</span><br><span class="line">            tick.<span class="built_in">close</span>();</span><br><span class="line">            <span class="keyword">return</span> status;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Status::Failure;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="Key-Behavior-4"><a href="#Key-Behavior-4" class="headerlink" title="Key Behavior:"></a>Key Behavior:</h3><ul>
<li><strong>Conditional Execution:</strong> Runs its child only if the condition method returns true.</li>
<li><strong>User-Defined Conditions:</strong> Requires inheriting classes to implement the condition method.</li>
<li><strong>Returns Failure:</strong> If the condition is not met, it returns Failure without running the child.</li>
</ul>
<h2 id="InverterNode"><a href="#InverterNode" class="headerlink" title="InverterNode"></a>InverterNode</h2><p>The BTInverterNode <strong>flips the outcome of its child node</strong>. If the child returns Success, the inverter returns Failure, and vice versa. If the child returns Running, the inverter simply passes on that status.</p>
<h3 id="code-3"><a href="#code-3" class="headerlink" title="code"></a>code</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BTInverterNode</span> : <span class="keyword">public</span> BTDecoratorNode &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">BTInverterNode</span>(Task* child) : <span class="built_in">BTDecoratorNode</span>(child) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">Status <span class="title">run</span><span class="params">(Tick&amp; tick)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        tick.<span class="built_in">open</span>(*child);</span><br><span class="line">        Status status = tick.<span class="built_in">execute</span>();</span><br><span class="line">        tick.<span class="built_in">close</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Invert the success/failure status of the child</span></span><br><span class="line">        <span class="keyword">if</span> (status == Status::Success) &#123;</span><br><span class="line">            <span class="keyword">return</span> Status::Failure;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (status == Status::Failure) &#123;</span><br><span class="line">            <span class="keyword">return</span> Status::Success;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// If the child is running or returns an error, keep the original status</span></span><br><span class="line">        <span class="keyword">return</span> status;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="Key-Behavior-5"><a href="#Key-Behavior-5" class="headerlink" title="Key Behavior:"></a>Key Behavior:</h3><ul>
<li><strong>Invert Status:</strong> Converts Success to Failure and Failure to Success.</li>
<li><strong>Pass Through Running:</strong> If the child is still running, it does not change the status.</li>
</ul>
<h1 id="Demonstration-of-Behavior-Tree-Logic-An-Monster-AI-Example"><a href="#Demonstration-of-Behavior-Tree-Logic-An-Monster-AI-Example" class="headerlink" title="Demonstration of Behavior Tree Logic: An Monster AI Example"></a>Demonstration of Behavior Tree Logic: An Monster AI Example</h1><p>The AI attempts the following behaviors in order:</p>
<p><strong>1. React to Visual Detection:</strong><br>A repeat-until-fail decorator checks if the AI can see the player (i.e., no obstacles blocking the view). If true, a sequence generates a path to the player, prompts the AI to say, “I see you,” and moves along the path.</p>
<p><strong>2. React to Distance Detection:</strong><br>Another repeat-until-fail decorator checks if the AI can hear the player (based on distance). If true, a sequence randomly generates a path, prompts the AI to say, “I heard you,” and moves along the path.</p>
<p><strong>3. Wander Behavior:</strong><br>A condition node checks if the AI has been wandering for more than 3 seconds (or hasn’t started wandering). If true, it generates a random path for the AI to follow.</p>
<div align="center">
  <img src="/images/GameAIDemo/MonsterBTdiag.png" alt="Game Screenshot">
  <p>Behavior Tree Structure</p>
</div>

<div align="center">
  <img src="/images/GameAIDemo/BTdemo.png" alt="Game Screenshot">
  <p>Screenshot of Demo</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://zhangzs11.github.io">Zishuai Zhang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://zhangzs11.github.io/2024/07/25/Game%20AI%20in%20C++%20with%20openFrameworks%20-%20Behaviour%20Tree/">https://zhangzs11.github.io/2024/07/25/Game%20AI%20in%20C++%20with%20openFrameworks%20-%20Behaviour%20Tree/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="/img/MyAvatar.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2024/08/29/GameEngineII-Assignment01Write-Up/" title="Setting Up the Graphics Module in Visual Studio"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">Setting Up the Graphics Module in Visual Studio</div></div><div class="info-2"><div class="info-item-1">Download the Game DemoYou can download the demo of the game using the link below. Experience a color-changing animation controlled by spacebar keyboard inputs. Download Game Demo ZIP How to Control the Game Spacebar: Press the spacebar to accelerate the color change animation in the demo.  Assignment 01 Description: Add the Graphics module to an engine that lacks the Graphics component, establish dependencies, and add the Graphics module as a dependency to other engine modules that require...</div></div></div></a><a class="pagination-related" href="/2024/07/10/Game%20AI%20in%20C++%20with%20openFrameworks%20-%20Pathfinding/" title="Game AI in C++ with openFrameworks - Pathfinding"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">Game AI in C++ with openFrameworks - Pathfinding</div></div><div class="info-2"><div class="info-item-1">Pathfinding AlgorithmsPathfinding algorithms are essential for navigating game environments, and the key differences between these algorithms lies in how they prioritize which nodes to explore first. This prioritization is typically managed through a frontier set or queue, where nodes are sorted based on different criteria. Dijkstra’s AlgorithmPrioritization:Dijkstra’s Algorithm prioritizes nodes solely based on the cost from the start node to the current node (g(n)). It expands nodes with...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/MyAvatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Zishuai Zhang</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">25</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">5</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/zhangzs11" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:zhangzs2023@163.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#BehaviourTree-Class"><span class="toc-number">1.</span> <span class="toc-text">BehaviourTree Class</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Code"><span class="toc-number">1.1.</span> <span class="toc-text">Code</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Components"><span class="toc-number">1.2.</span> <span class="toc-text">Components</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Each-Node-returns-a-Status"><span class="toc-number">2.</span> <span class="toc-text">Each Node returns a Status</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#How-Status-Affects-Node-Execution"><span class="toc-number">2.1.</span> <span class="toc-text">How Status Affects Node Execution</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Why-This-Approach-Matters"><span class="toc-number">2.2.</span> <span class="toc-text">Why This Approach Matters</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Action-and-ActionNode"><span class="toc-number">3.</span> <span class="toc-text">Action and ActionNode</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#BTAction-Class"><span class="toc-number">3.1.</span> <span class="toc-text">BTAction Class</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BTActionNode-Class"><span class="toc-number">3.2.</span> <span class="toc-text">BTActionNode Class</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-BTChangeColorAction"><span class="toc-number">3.3.</span> <span class="toc-text">Example: BTChangeColorAction</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Control-nodes"><span class="toc-number">4.</span> <span class="toc-text">Control nodes</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SelectorNode"><span class="toc-number">4.1.</span> <span class="toc-text">SelectorNode</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Key-Behavior"><span class="toc-number">4.1.1.</span> <span class="toc-text">Key Behavior:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Code-1"><span class="toc-number">4.1.2.</span> <span class="toc-text">Code:</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SequenceNode"><span class="toc-number">4.2.</span> <span class="toc-text">SequenceNode</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Key-Behavior-1"><span class="toc-number">4.2.1.</span> <span class="toc-text">Key Behavior:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Code-2"><span class="toc-number">4.2.2.</span> <span class="toc-text">Code:</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NondeterministicSelectorNode"><span class="toc-number">4.3.</span> <span class="toc-text">NondeterministicSelectorNode</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Key-Behavior-2"><span class="toc-number">4.3.1.</span> <span class="toc-text">Key Behavior:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Code-3"><span class="toc-number">4.3.2.</span> <span class="toc-text">Code:</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Decorator-Nodes"><span class="toc-number">5.</span> <span class="toc-text">Decorator Nodes</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#DecoratorNode-The-Base-Class"><span class="toc-number">5.1.</span> <span class="toc-text">DecoratorNode - The Base Class</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#code"><span class="toc-number">5.1.1.</span> <span class="toc-text">code</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RepeatUntilFailNode"><span class="toc-number">5.2.</span> <span class="toc-text">RepeatUntilFailNode</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#code-1"><span class="toc-number">5.2.1.</span> <span class="toc-text">code</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Key-Behavior-3"><span class="toc-number">5.2.2.</span> <span class="toc-text">Key Behavior:</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ConditionalDecoratorNode"><span class="toc-number">5.3.</span> <span class="toc-text">ConditionalDecoratorNode</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#code-2"><span class="toc-number">5.3.1.</span> <span class="toc-text">code</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Key-Behavior-4"><span class="toc-number">5.3.2.</span> <span class="toc-text">Key Behavior:</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#InverterNode"><span class="toc-number">5.4.</span> <span class="toc-text">InverterNode</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#code-3"><span class="toc-number">5.4.1.</span> <span class="toc-text">code</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Key-Behavior-5"><span class="toc-number">5.4.2.</span> <span class="toc-text">Key Behavior:</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Demonstration-of-Behavior-Tree-Logic-An-Monster-AI-Example"><span class="toc-number">6.</span> <span class="toc-text">Demonstration of Behavior Tree Logic: An Monster AI Example</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/01/06/SoftRender--Triangle%20Rasterization/" title="Software Rasterizer - Triangle Rasterization">Software Rasterizer - Triangle Rasterization</a><time datetime="2025-01-07T00:14:31.379Z" title="Created 2025-01-06 17:14:31">2025-01-06</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/01/06/SoftRender--Wireframe%20Rendering/" title="Software Rasterizer - Wireframe Clipping and Rendering">Software Rasterizer - Wireframe Clipping and Rendering</a><time datetime="2025-01-06T21:55:42.372Z" title="Created 2025-01-06 14:55:42">2025-01-06</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/12/16/Graphics_System-Shadow/" title="Graphics_System-Shadow Mapping">Graphics_System-Shadow Mapping</a><time datetime="2024-12-16T07:00:00.000Z" title="Created 2024-12-16 00:00:00">2024-12-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/12/02/GameEngineII-FInal%20Project/" title="EAEGameEngineII-Final Game Write-Up">EAEGameEngineII-Final Game Write-Up</a><time datetime="2024-12-02T07:00:00.000Z" title="Created 2024-12-02 00:00:00">2024-12-02</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/11/13/GameEngineII-Final_Project_Proposal/" title="EAEGameEngineII-Final_Project_Proposal">EAEGameEngineII-Final_Project_Proposal</a><time datetime="2024-11-13T07:00:00.000Z" title="Created 2024-11-13 00:00:00">2024-11-13</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2025 By Zishuai Zhang</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(() => {
  const loadMathjax = () => {
    if (!window.MathJax) {
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          tags: 'none',
        },
        chtml: {
          scale: 1.1
        },
        options: {
          enableMenu: true,
          renderActions: {
            findScript: [10, doc => {
              for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
                const display = !!node.type.match(/; *mode=display/)
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
                const text = document.createTextNode('')
                node.parentNode.replaceChild(text, node)
                math.start = {node: text, delim: '', n: 0}
                math.end = {node: text, delim: '', n: 0}
                doc.math.push(math)
              }
            }, '']
          }
        }
      }
      
      const script = document.createElement('script')
      script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
      script.id = 'MathJax-script'
      script.async = true
      document.head.appendChild(script)
    } else {
      MathJax.startup.document.state(0)
      MathJax.texReset()
      MathJax.typesetPromise()
    }
  }

  btf.addGlobalFn('encrypt', loadMathjax, 'mathjax')
  window.pjax ? loadMathjax() : window.addEventListener('load', loadMathjax)
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>